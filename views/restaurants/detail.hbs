{{!< layouts/main }}

<section class="page detail-page">

  <header class="detail-header">
    <div class="detail-main-info">
      <p class="detail-breadcrumb">
        <a href="/restaurants">← Back to search</a>
      </p>

      <h1 class="detail-name">{{restaurant.name}}</h1>

      <p class="detail-meta">
        {{#if restaurant.cuisine}}{{restaurant.cuisine}}{{/if}}
        {{#if restaurant.cuisine}} · {{/if}}
        {{#if restaurant.borough}}{{restaurant.borough}}{{/if}}
      </p>

      {{#if restaurant.address}}
        <p class="detail-address">{{restaurant.address}}</p>
      {{/if}}

      {{#if restaurant.phone}}
        <p class="detail-phone">Phone: {{restaurant.phone}}</p>
      {{/if}}
    </div>

    <div class="detail-grade-card">
      <p class="detail-grade-label">Current grade</p>
      <div class="detail-grade-badge grade-{{restaurant.currentGrade}}">
        {{#if restaurant.currentGrade}}{{restaurant.currentGrade}}{{else}}N/A{{/if}}
      </div>

      {{#if restaurant.score}}
        <p class="detail-score">
          Score: <span>{{restaurant.score}}</span>
        </p>
      {{/if}}

      {{#if restaurant.lastInspectionDate}}
        <p class="detail-last-inspection">
          Last inspection: {{restaurant.lastInspectionDate}}
        </p>
      {{/if}}
    </div>
  </header>

  <div class="detail-layout">
    <!-- 左侧：inspection & violations -->
    <section class="detail-left">
      <h2>Inspection history</h2>

      {{#if inspections.length}}
        <ul class="inspection-timeline">
          {{#each inspections}}
            <li class="inspection-item">
              <div class="inspection-dot"></div>
              <div class="inspection-content">
                <div class="inspection-row">
                  <span class="inspection-date">{{this.date}}</span>
                  {{#if this.grade}}
                    <span class="inspection-grade-badge grade-{{this.grade}}">
                      {{this.grade}}
                    </span>
                  {{/if}}
                </div>

                {{#if this.score}}
                  <p class="inspection-score">Score: {{this.score}}</p>
                {{/if}}

                {{#if this.summary}}
                  <p class="inspection-summary">{{this.summary}}</p>
                {{/if}}
              </div>
            </li>
          {{/each}}
        </ul>
      {{else}}
        <p class="empty-text">No inspection records available.</p>
      {{/if}}

      <h2>Violations</h2>

      {{#if violations.length}}
        <div class="violations-table-wrapper">
          <table class="violations-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Code</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              {{#each violations}}
                <tr>
                  <td>{{this.date}}</td>
                  <td>{{this.code}}</td>
                  <td>{{this.description}}</td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      {{else}}
        <p class="empty-text">No recorded violations.</p>
      {{/if}}
    </section>

    <!-- 右侧：reviews -->
    <aside class="detail-right">
      <section class="reviews-section">
        <h2>User reviews</h2>

        {{#if avgRating}}
          <p class="reviews-average">
            Average rating: <span>{{avgRating}}</span>/5
          </p>
        {{/if}}

        {{#if reviews.length}}
          <ul class="reviews-list">
            {{#each reviews}}
              <li class="review-card">
                <div class="review-header">
                  <span class="review-user">{{this.username}}</span>
                  {{#if this.rating}}
                    <span class="review-rating">{{this.rating}}★</span>
                  {{/if}}
                </div>
                {{#if this.date}}
                  <p class="review-date">{{this.date}}</p>
                {{/if}}
                <p class="review-text">{{this.comment}}</p>
              </li>
            {{/each}}
          </ul>
        {{else}}
          <p class="empty-text">
            No reviews yet. Be the first to review this restaurant.
          </p>
        {{/if}}
      </section>

      <section class="add-review-section">
        <h3>Leave a review</h3>
        <form class="review-form" action="/restaurants/{{restaurant._id}}/reviews" method="POST">
          <div class="form-group">
            <label for="rating">Rating</label>
            <select id="rating" name="rating" required>
              <option value="">Select rating</option>
              <option value="5">5 - Excellent</option>
              <option value="4">4 - Good</option>
              <option value="3">3 - Okay</option>
              <option value="2">2 - Poor</option>
              <option value="1">1 - Bad</option>
            </select>
          </div>

          <div class="form-group">
            <label for="comment">Comment</label>
            <textarea
              id="comment"
              name="comment"
              rows="4"
              placeholder="Share your experience..."
              required
            ></textarea>
          </div>

          <button type="submit" class="btn-primary review-btn">
            Submit review
          </button>
        </form>
      </section>
    </aside>
  </div>
</section>
