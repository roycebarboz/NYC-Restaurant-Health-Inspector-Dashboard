{{!< layouts/main }}

<section class="page search-page">
  <div class="search-layout">

    <!-- 左侧：筛选区域 -->
    <aside class="search-filters">
      <h1 class="search-title">Search restaurants</h1>
      <p class="search-subtitle">
        Filter NYC restaurants by name, location, cuisine, and health grade.
      </p>

      <form class="search-form" method="GET" action="/restaurants">
        <div class="form-group">
          <label for="name">Restaurant name</label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="e.g. Joe's Pizza"
            value="{{query.name}}"
          >
        </div>

        <div class="form-group">
          <label for="cuisine">Cuisine</label>
          <input
            type="text"
            id="cuisine"
            name="cuisine"
            placeholder="e.g. Chinese, Italian"
            value="{{query.cuisine}}"
          >
        </div>

        <div class="form-group">
          <label for="borough">Borough</label>
          <select id="borough" name="borough">
            <option value="">All boroughs</option>
            <option value="Manhattan" {{#ifEquals query.borough "Manhattan"}}selected{{/ifEquals}}>Manhattan</option>
            <option value="Brooklyn" {{#ifEquals query.borough "Brooklyn"}}selected{{/ifEquals}}>Brooklyn</option>
            <option value="Queens" {{#ifEquals query.borough "Queens"}}selected{{/ifEquals}}>Queens</option>
            <option value="Bronx" {{#ifEquals query.borough "Bronx"}}selected{{/ifEquals}}>Bronx</option>
            <option value="Staten Island" {{#ifEquals query.borough "Staten Island"}}selected{{/ifEquals}}>Staten Island</option>
          </select>
        </div>

        <div class="form-group">
          <label for="zip">ZIP code</label>
          <input
            type="text"
            id="zip"
            name="zip"
            placeholder="e.g. 10027"
            value="{{query.zip}}"
          >
        </div>

        <div class="form-group">
          <label for="grade">Current grade</label>
          <select id="grade" name="grade">
            <option value="">Any grade</option>
            <option value="A" {{#ifEquals query.grade "A"}}selected{{/ifEquals}}>A</option>
            <option value="B" {{#ifEquals query.grade "B"}}selected{{/ifEquals}}>B</option>
            <option value="C" {{#ifEquals query.grade "C"}}selected{{/ifEquals}}>C</option>
            <option value="P" {{#ifEquals query.grade "P"}}selected{{/ifEquals}}>Pending (P)</option>
            <option value="Z" {{#ifEquals query.grade "Z"}}selected{{/ifEquals}}>Grade Pending (Z)</option>
            <option value="Not Yet Graded" {{#ifEquals query.grade "Not Yet Graded"}}selected{{/ifEquals}}>
              Not Yet Graded
            </option>
          </select>
        </div>

        <button type="submit" class="btn-primary search-btn">Apply filters</button>
      </form>
    </aside>

    <!-- 右侧：结果列表 -->
    <section class="search-results">
      <header class="results-header">
        <h2>Results</h2>
        {{#if restaurants}}
          <p class="results-count">{{restaurants.length}} restaurants found</p>
        {{else}}
          <p class="results-count">No results yet. Try searching with filters.</p>
        {{/if}}
      </header>

      <div class="results-list">
        {{#if restaurants}}
          {{#each restaurants}}
            <article class="restaurant-card">
              <div class="restaurant-main">
                <h3 class="restaurant-name">
                  <a href="/restaurants/{{this._id}}">{{this.name}}</a>
                </h3>

                <p class="restaurant-meta">
                  {{this.cuisine}} · {{this.borough}}
                </p>

                <p class="restaurant-address">
                  {{this.address}}
                </p>
              </div>

              <div class="restaurant-side">
                <span class="grade-badge grade-{{this.currentGrade}}">
                  {{this.currentGrade}}
                </span>
                <a href="/restaurants/{{this._id}}" class="restaurant-link">
                  View details →
                </a>
              </div>
            </article>
          {{/each}}
        {{/if}}
      </div>

      {{!-- 分页占位（将来后端可以传 currentPage / totalPages） --}}
      {{#if pagination}}
        <div class="pagination">
          {{#if pagination.hasPrev}}
            <a href="{{pagination.prevUrl}}" class="page-link">Previous</a>
          {{/if}}

          <span class="page-current">
            Page {{pagination.current}} of {{pagination.total}}
          </span>

          {{#if pagination.hasNext}}
            <a href="{{pagination.nextUrl}}" class="page-link">Next</a>
          {{/if}}
        </div>
      {{/if}}
    </section>
  </div>
</section>
